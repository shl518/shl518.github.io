---
title: 时序逻辑
date: 2022-05-09 15:21:39
tags: 计算机组成
---

### 时序逻辑

----------------------------

#### RS锁存器

##### 基本的RS锁存器

如下图：
![a](https://note.youdao.com/yws/api/personal/file/4D339BFD974249A9824B4471781068ED?method=download&shareKey=d00240532aa059cb1e338f2e9688fc0a)
运用了**双稳态电路**实现了如下功能(低电平有效类型)：

| ~RD  | ~SD  |                 功能                 |
| :--: | :--: | :----------------------------------: |
|  1   |  1   |     触发器保持原状态不变(Q不变)      |
|  0   |  1   |              置0（Q=0）              |
|  1   |  0   |              置1（Q=1）              |
|  0   |  0   | 不确定状态（由于门延迟而产生了竞争） |

##### 钟控RS锁存器

加入了时钟信号：
![2](https://note.youdao.com/yws/api/personal/file/7CC3B7215DA04563A8638B68EA554E81?method=download&shareKey=78c7a705c7448374089969b6d66619ca)
![3](https://note.youdao.com/yws/api/personal/file/2E2F7E20214F409DAC16C59E4F6B0D9C?method=download&shareKey=1ebac36d709e326a66c93c541dba16f6)
当CP=0时，RS锁存器输入均为1，保持原状态。
CP=1时，RS锁存器正常工作。

##### 钟控D锁存器(钟控RS+反相器)

钟控D所存通过加入反向器，保证两个输入不同，避免了出现类似RS锁存器的不确定状态。
![d](https://note.youdao.com/yws/api/personal/file/74136CBC854A4D30BB88816D52A4F819?method=download&shareKey=cc83478c2dff963b57f6ebba3f3cf9b8)

|  CP  |  D   | function |
| :--: | :--: | :------: |
|  0   |  x   | 保持原态 |
|  1   |  1   |   置1    |
|  1   |  0   |   置0    |

-------------------------

##### D触发器

两个反相的D锁存器构成，持股发起的抓捕富态变化只在时钟的有效沿发生变化（上升沿或下降沿），D锁存器电平敏感，D触发器边沿触发。寄存器便是由多个共享CLK信号的D触发器构成
![3](https://note.youdao.com/yws/api/personal/file/D3C16E3318464D0882D76A4F1E72314D?method=download&shareKey=7d5dd1e3b92ece4687d9ab296c05e86b)

##### 带使能端的D触发和带重置功能的D触发

只需将使能端与在时钟端，或将重置端与在信号输入端。

![4](https://note.youdao.com/yws/api/personal/file/9891E081BB994864808F7909BD3E9830?method=download&shareKey=50112449e9e78249f481ebd4efbfd543)
![5](https://note.youdao.com/yws/api/personal/file/E0866D7136F049CB94990EA16AA56F15?method=download&shareKey=4e26c0515fab8d20742a1a43b3823ae3)

-------------------------------

##### JK触发器

将RS=11的无序状态转化为了翻转功能:
![6](https://note.youdao.com/yws/api/personal/file/F58CCBA967DF40BE9BADE2A15BA2FA59?method=download&shareKey=9613ef863baff5dd7abc5cf126c12164)

|  J   |  K   |   function   |
| :--: | :--: | :----------: |
|  0   |  0   |     保持     |
|  0   |  1   |     置0      |
|  1   |  0   |     置1      |
|  1   |  1   | 翻转（取反） |

------------------------------

### 一个Mealy的例子

![9](https://note.youdao.com/yws/api/personal/file/422D1DB9DB4140BA9E6B5453FE2B9CDB?method=download&shareKey=104cea3899abde8b675917b753690132)

题目中只要求不重复检测，在这里为了练习我们分两种情况讨论(**有限状态机的难点在于画出状态转换图，其他剩下的便是工作量的问题**)

---------------

**不重复检测情况**：1101101只算一个1101
状态转换图：
![rr](https://note.youdao.com/yws/api/personal/file/27325F789C93419CA235E475959277AB?method=download&shareKey=3bc8913c778f1cbab26230ede242f4c3)
之后为每个状态编码，画出状态转换表，将电路分成两个子电路（状态转换与状态输出，最后加一个寄存器）很容易便可以画出Logisim电路，不做叙述，这里附一个verilog程序，在这个HDL程序内我们利用了`Always@(*)`搭建组合逻辑，可以学习一下：

```verilog
module code_checker(
    input clk,
    input data,
    input clr,
    output reg out
    );
parameter S0=3'b000;
parameter S1=3'b001;
parameter S2=3'b010;
parameter S3=3'b011;
parameter S4=3'b100;
reg [2:0] status;
always @(posedge clk or posedge clr) begin //注意这里不仅有时钟上升沿，还有reset信号上升沿
    if(clr)begin
        status <= S0;//reset
    end
    else begin
        case (status)
            S0: if(data == 1'b0)status <= S0;else status<= S1;
            S1: if(data == 1'b1)status <= S2;else status <= S0;
            S2: if(data == 1'b0)status <= S3;else status <= S2;
            S3: if(data == 1'b0)status <= S0;else status <= S4;
            S4: if(data == 1'b1)status <= S1;else status <= S0;
            default :status <=S0;
        endcase   //case 语法可以不用加begin，end
    end
    
end
always @(*)begin
    case (status)
        S0:out = 1'b0;
        S1:out = 1'b0;
        S2: out = 1'b0;
        S3:if(data == 1'b1)out =1'b1;else out = 1'b0;//易错
        S4: out = 1'b0;
        default: out =1'b0;
    endcase
end

endmodule

```

Mealy编写注意事项：

- 有reset信号需要在always@（posedge clk or **posedge clr**）写明。
- mealy状态机的状态输出与输入有关，可以用always建立组合逻辑，建立组合逻辑时建议使用阻塞赋值=。
- case语句中一定要写明`default`状态.
- mealy的组合逻辑与moore不同，不能仅凭当前状态判断输出。
- 状态机的case语句判定的一般都是status的变化

**若重复检测**：1101101算两个1101，只要改变一下状态转换图即可
![eee](https://note.youdao.com/yws/api/personal/file/8ABFDCE30063401D88C8AED395C91FDD?method=download&shareKey=0e8447da9530ba8c28f2f3067e3a7ab3)

### 重点--时序电路的时序

![a](https://note.youdao.com/yws/api/personal/file/4F8B5CAD1D8F41CAA189098BFAED8402?method=download&shareKey=1d46cf3b452e103d2e629dd08fc986f8)
![b](https://note.youdao.com/yws/api/personal/file/FBC27D856B88469B9396C81F81FC9157?method=download&shareKey=1e97febfd3d6d2a6d33bacf1f6a9d4a6)

- **同步时序电路的时钟周期与组合逻辑最长路径有关**

![C](https://note.youdao.com/yws/api/personal/file/78584CBDA4564167AB6F78B5A0BBCDBD?method=download&shareKey=844c503bb7c2076ed26635bcc7c09c9d)

- **保持时间约束与组合逻辑最短路径有关**

--------------------------

### 数据寄存器与数据锁存器

**数据寄存器**
![1](https://note.youdao.com/yws/api/personal/file/A1631345396F4BFE9B3B82124745AB46?method=download&shareKey=90ad7333df6a28fabd31fffc4eada20c)

- 由边沿触发的触发器构成（D触发），脉冲敏感型 
- 适用于数据有效提前于控制信号

```v
always @(posedge clk or posedge rst)
```

**数据锁存器**

- 由电位触发器（D锁存器）组成，电平敏感
- 数据有效滞后于控制信号

```v
always @(clk or rst)
```

------------------------

### 移位寄存器

#### 四位右移寄存器

![]()

- 由四个D触发组成，数据从左端输入，依此通过低位寄存器，高位触发器的输出送低位触发器的输入
- 有两种工作方式
  - 串入并出：N位移位寄存器经过N个CP后，最后一个输出恰好为第一个输入，此时从低位到高位的输出正好为完整的输入串，称为并行输出。
  - 串入串出；每一个输出都会串行输出输入串，只不过后级触发器的输出比前一个触发器要晚一个周期，把处于串入串出的移位寄存器称为**延迟线**。

#### 双向移位寄存器

**通过在触发器的输入端增加门电路来增加控制左右移的功能**
![3](https://note.youdao.com/yws/api/personal/file/2E83B9F516954A45A6D031A5A34BE929?method=download&shareKey=e7f7bfaec1a208e77a68d61bb6dc6371)

- CT74194芯片：一共四个功能，通过S1，S0控制
  ![4](https://note.youdao.com/yws/api/personal/file/7B0E78D4E3C54B8983DDC51D0BB7103D?method=download&shareKey=2e134456bdfc0b4ead27941887df8a94)

-----------------------

### 计数器

#### 同步计数器

- 功能：计数计时，分频，产生节拍脉冲和序列脉冲
- 分类
  - 时钟方式：同步计数器，异步计数器
  - 计数方式：M进制计数器
  - 状态分类：加法，减法，加/减法
- 同步二进制计数器也称为分频器，实际上CP进行了2，4，8，16分频

#### 异步计数器

- 高位触发器的时钟信号由低位触发器的输出提供，高位触发器的翻转等待低一位的触发器反转后才能进行。
- 触发器不同步，出现尖锋脉冲
  ![11](https://note.youdao.com/yws/api/personal/file/DBD3D2E6B38249489973D9D75E1ABD7C?method=download&shareKey=99397cfe426733cb3aa59d593eb75f79)
