---
title: é¢å‘å¯¹è±¡ç¬¬3å•å…ƒä½œä¸šæ€»ç»“
date: 2022-06-22 15:49:49
tags: é¢å‘å¯¹è±¡
---

##                                                                                            é¢å‘å¯¹è±¡ç¬¬ä¸‰æ¬¡å•å…ƒæ€»ç»“

## å‰è¨€

æœ¬å•å…ƒå­¦ä¹ äº†JMLç›¸å…³å†…å®¹ã€‚æœ¬ç¯‡æ–‡ç« è®²è§£äº†ä¸‰æ¬¡ä½œä¸šä¸­å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„å®¹å™¨ï¼Œå¦‚ä½•é€‰æ‹©æ­£ç¡®çš„ç®—æ³•è§£å†³å¯èƒ½å‡ºç°çš„æ€§èƒ½é—®é¢˜ã€‚åŒæ—¶ä¹Ÿé˜é‡Šäº†æœ¬æ¬¡ä½œä¸šçš„æµ‹è¯•æ–¹æ³•ä¸Hackç­–ç•¥ã€‚æœ€åå®Œæˆäº†å¯¹äºNetworkçš„ä¸€ä¸ªæ‹“å±•ï¼Œå®ç°äº†ä¸€ä¸ªä¹°å–å¹¿å‘Šç³»ç»Ÿï¼Œå®Œæˆäº†å¯¹ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•çš„JMLçš„æ’°å†™ã€‚å¦‚æœ‰é”™è¯¯ï¼Œè°¢è°¢æŒ‡æ­£ï¼

------------------------------

## é˜…è¯»JMLå’Œå®ç°JMLçš„ç­–ç•¥

åœ¨æœ¬å•å…ƒçš„ä»£ç å®ç°è¿‡ç¨‹ä¸­ï¼Œç”±äºå·²ç»ç”¨JMLä¸ºæˆ‘ä»¬å®šä¹‰äº†æ–¹æ³•çš„è§„æ ¼ï¼Œæ‰€ä»¥åªéœ€è¦å°†JMLç¿»è¯‘æˆä»£ç è¯­è¨€å³å¯ã€‚åœ¨ç¿»è¯‘çš„è¿‡ç¨‹ä¸­éœ€è¦ç¡®ä¿å®ç°çš„é€»è¾‘ä¸¥è°¨ä»¥åŠä¸¥æ ¼ç¬¦åˆJMLçš„è§„æ ¼ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼Œåœ¨æœ¬å•å…ƒä¸­è®¤çœŸé˜…è¯»JMLå’ŒæŒæ¡JMLå„é¡¹å«ä¹‰ï¼Œå®ç°æ­£ç¡®çš„æ¶æ„åŸºæœ¬æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜ï¼Œä½†å‰ææ˜¯è¦è®¤çœŸé˜…è¯»JMLå¹¶æå–å‡ºå…¶å…¨éƒ¨ä¿¡æ¯ï¼Œå¦åˆ™æ­£ç¡®æ€§è‚¯å®šéš¾ä»¥ä¿è¯ã€‚

- ç¬¬ä¸€ä¸ªç­–ç•¥ï¼šåœ¨æœ¬æ¬¡ä¸­æˆ‘è®¤ä¸ºæ›´å¿«å®ç°JMLçš„ä¸€ä¸ªç­–ç•¥å°±æ˜¯**æŒ‰ä¸€å®šé¡ºåºï¼Œä»åº•åˆ°ä¸Šçš„å®ç°JML**ï¼ŒæŒ‰ç…§è¿™æ ·å®ç°çš„é¡ºåºé€»è¾‘ä¼šæ›´åŠ é€šç•…å¹¶ä¸”æ¶æ„æ›´åŠ æ¸…æ™°ã€‚æˆ‘çš„è®¾è®¡ç­–ç•¥æ˜¯é¦–å…ˆå®ç°å¼‚å¸¸ç±»ï¼Œç„¶ååˆ†åˆ«å®ç°ä¸åŒçš„ç±»ã€‚ä»ç±»çš„åŒ…å«å…³ç³»æ¥çœ‹ï¼Œé¦–å…ˆå®ç°è¾ƒä¸ºç®€å•çš„Personç±»å’ŒMesageç±»ï¼Œæ¥ç€å®ç°åŒ…å«è¿™ä¸¤ä¸ªç±»çš„Gruopç±»ï¼Œæœ€åå®ç°è¾ƒä¸ºå¤æ‚çš„Networkç±»ã€‚

- ç¬¬äºŒä¸ªç­–ç•¥ï¼šå¦ä¸€ä¸ªå®ç°JMLçš„ç­–ç•¥ä¾¿æ˜¯**å®¹å™¨çš„é€‰æ‹©**ï¼Œåœ¨æœ¬å•å…ƒä¸­æˆ‘ç¬¬ä¸€æ¬¡è§åˆ°äº†HashMapçš„ å¨åŠ›ï¼Œåœ¨ä¹‹å‰å•å…ƒæˆ‘ä¸€ç›´é‡‡å–çš„éƒ½æ˜¯å¸¸ç”¨çš„ArrayListåŠ¨æ€æ–¹æ³•æ¥è¿›è¡Œå­˜å‚¨ã€‚åœ¨æœ¬å•å…ƒé¦–æ¬¡ä½¿ç”¨HashMapè¿™ç±»çš„æ•°æ®ç»“æ„æ‰çŸ¥é“çœŸé¦™å•ŠğŸ˜ã€‚Hashmapå¯ä»¥å®ç°æ›´å¿«çš„æŸ¥æ‰¾ï¼Œä½†ä¹Ÿè¦å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ï¼Œæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ï¼Œä½†æˆ‘ä»¬çš„ä½œä¸šå‡ ä¹ä¸ç”¨è€ƒè™‘ç©ºé—´ä¸å¤Ÿçš„é—®é¢˜ï¼Œè€ƒè™‘æ—¶é—´æ‰æ˜¯ç¬¬ä¸€è¦åŠ¡ï¼Œå› æ­¤æœ¬å•å…ƒæˆ‘å‡ ä¹æ‰€æœ‰çš„æ•°æ®å­˜å‚¨ç»“æ„å…¨éƒ¨é‡‡ç”¨HashMapæ¥å®ç°ã€‚æ­¤å¤–åœ¨æœ¬å•å…ƒä¸­æˆ‘è¿˜å­¦ä¹ åˆ°äº†æ›´å¤šçš„å®¹å™¨ï¼Œä¾‹å¦‚HashSeté›†åˆï¼Œä¼˜å…ˆé˜Ÿåˆ—PriorityListï¼Œé“¾è¡¨LinkedListï¼Œ**è¿™äº›å®¹å™¨éƒ½è§†ä¸åŒçš„éœ€æ±‚è€Œä½¿ç”¨ï¼Œæ…é‡ã€æœºæ™ºçš„é€‰æ‹©ä¸åŒçš„å®¹å™¨ä¹Ÿæ˜¯æœ¬å•å…ƒçš„ä¸€å¤§é‡ç‚¹**ã€‚

## ä¸‰æ¬¡ä½œä¸šåˆ†æ

å¦‚æˆ‘åˆšåˆšæ‰€è¿°ï¼Œåªè¦JMLè®¤çœŸé˜…è¯»ï¼Œå®ç°çš„æ­£ç¡®æ€§æœ‰å¾ˆå¥½çš„ä¿è¯ï¼Œå› æ­¤æ¥ä¸‹æ¥çš„åˆ†æä¸»è¦å›´ç»•**å®¹å™¨çš„é€‰æ‹©**ä¸**æ€§èƒ½é—®é¢˜çš„è§£å†³**ã€‚è¿™é‡Œä¸å†åˆ†ä¸‰æ¬¡ä½œä¸šé€æ­¥å™è¿°ï¼Œè€Œæ˜¯æ•´ä½“è¿›è¡Œå™è¿°ï¼Œå› ä¸ºä¸‰æ¬¡ä½œä¸šæ²¡æœ‰æ˜æ˜¾çš„è¿­ä»£å…³ç³»ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªæ•´ä½“è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†æ¥å®Œæˆã€‚

### 1.1 ä¸åŒç±»ä¸­å®¹å™¨çš„é€‰æ‹©

åœ¨æœ¬æ¬¡ä½œä¸šä¸­è‡ªå·±ä¸»è¦é‡‡ç”¨äº† `HashMap` ï¼Œ`HashSet` ä»¥åŠ `LinkedList` å®¹å™¨ã€‚ä¸‹é¢å…·ä½“åˆ—å‡ºå®ç°ä¸­é‡‡ç”¨çš„å®¹å™¨ä»¥åŠå¦‚æ­¤é€‰æ‹©å®¹å™¨çš„ä¾æ®ã€‚

### Person

- `private HashMap<Person, Integer> acquaintance`

ç”¨æ¥å‚¨å­˜ä¸€ä¸ªäººçš„æœ‰å…³ç³»çš„äººä»¥åŠè¿™äº›å…³ç³»çš„å¯¹åº”valueå€¼ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨personç±»ä¸­åªéœ€è¦ä½¿ç”¨Personå’Œvalueçš„æ˜ å°„å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦å°†äºŒè€…åˆ†å¼€å­˜å‚¨ï¼Œè€Œæ˜¯å°†å…¶ç»Ÿä¸€å­˜æ”¾åœ¨Hashmapä¸­ï¼Œæ—¢å¯ä»¥å‡å°ç©ºé—´çš„å ç”¨ï¼Œåˆèƒ½å¾ˆå¥½çš„å®ç°åŠŸèƒ½çš„æŸ¥æ‰¾ï¼Œæ€»è€Œè¨€ä¹‹è¿™æ˜¯ä¸€ä¸ªæŠ€å·§ï¼Œç±»ä¼¼çš„æ˜ å°„å…³ç³»éƒ½å¯ä»¥é‡‡ç”¨Hashmapè¿™ç§å®¹å™¨æ¥å­˜å‚¨ã€‚

- `private LinkedList<Message> messages;`

 å‚¨å­˜ä¸€ä¸ªäººæ¥æ”¶åˆ°çš„ Messageã€‚ç”±äº `getReceivedMessages` æ–¹æ³•ä»¥åŠ `Network` ä¸­ `sendMessage` æ–¹æ³•çš„è§„æ ¼å¯¹ `messages` çš„é¡ºåºæœ‰è¦æ±‚ï¼Œæ•…é‡‡ç”¨ `List` è¿›è¡Œå­˜å‚¨ï¼›åˆç”±äº `sendMessage` å¯¹ `messages` è¿›è¡Œçš„æ˜¯å¤´æ’æ“ä½œï¼Œä¸”æ²¡æœ‰æ¶‰åŠåˆ°å¯¹è¿™ä¸ª `List` çš„æŒ‰ä¸‹æ ‡è®¿é—®ï¼Œæ•…ç›¸è¾ƒäº `ArrayList` è€Œè¨€é€‰ç”¨äº†æ›´é€‚åˆå¤´æ’ä¸é¡ºåºéå†çš„ é“¾è¡¨`LinkedList`

### Group

- `HashMap: <Person.id, Person>`

 è¯¥å®¹å™¨å‚¨å­˜è¯¥ group å†…å«æœ‰çš„äººã€‚è¿™é‡Œé€‰ç”¨äº† `HashMap` æ˜¯å‡ºäºè€ƒè™‘åˆ°æˆ‘ä»¬å®ç°çš„ `Network` éœ€è¦å¤§é‡çš„æ ¹æ® `id` æŸ¥è¯¢åˆ°æŸä¸ªPersonçš„æ“ä½œï¼Œæ‰€ä»¥å°† id å’Œå®ä½“å»ºç«‹ `HashMap` ä»¥ä¾¿äºæŸ¥è¯¢ã€‚

### Network

- `HashMap: <Person.id, Person>`

ç”¨äºå®ç°id-->personçš„å¿«é€ŸæŸ¥æ‰¾ã€‚

- `HashMap: <Message.id, Message>`

ç”¨äºå®ç°id-->messageçš„å¿«é€ŸæŸ¥æ‰¾ã€‚

- `HashMap: <Group.id, Group>`

ç”¨äºå®ç°id-->groupçš„å¿«é€ŸæŸ¥æ‰¾ã€‚

- `HashMap: <Emoji.id, Emoji.heat>` 

ç”¨äºå­˜å‚¨è¯¥ Network ä¸­å«æœ‰çš„è¡¨æƒ…ä»¥åŠè¡¨æƒ…å¯¹åº”çš„çƒ­åº¦ã€‚

- `HashMap<Person.id, Person.id> father;//id-father`

ç”¨äºå®ç°å¹¶æŸ¥é›†çš„åŸºæœ¬ç»“æ„ï¼Œå¹¶æŸ¥é›†å¯ä»¥ç”¨äºæŸ¥æ‰¾æ˜¯å¦è¿é€šisCircle()å’ŒæŸ¥è¯¢æœ€å°ç”Ÿæˆæ ‘queryLeastConnection()

- `HashMap<emoji.id, heat> // emoji id-heat`

ç”¨äºå®ç°emoji.id--->heatçš„å¿«é€ŸæŸ¥æ‰¾ã€‚

### 1.2 æ€§èƒ½é—®é¢˜çš„è§£å†³

åœ¨æœ¬éƒ¨åˆ†æˆ‘å°†å›´ç»•ä¸‰æ¬¡ä½œä¸šä¸­å¯èƒ½å‡ºç°æ€§èƒ½é—®é¢˜çš„å‡ ä¸ªå‡½æ•°è¿›è¡Œé˜è¿°ï¼Œå¹¶è§£é‡Šæˆ‘å¦‚ä½•è§£å†³è¿™äº›æ€§èƒ½é—®é¢˜ã€‚åœ¨ä¸‰æ¬¡ä½œä¸šä¸­æˆ‘ä»¬éœ€è¦æ ¹æ®JMlå®ç°è®¸å¤šå‡½æ•°åŠŸèƒ½ï¼Œä¸€æ—¦è¿™äº›å‡½æ•°è®¾è®¡åˆ°O(n^2)åŠä»¥ä¸Šçš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å°±è¦æ…é‡çš„è€ƒè™‘å…¶å®ç°æ–¹å¼ï¼Œå°½å¯èƒ½çš„é™ä½å…¶æ—¶é—´å¤æ‚åº¦ã€‚

#### 1.2.1 getValueSum (qgvs) ----ç»´æŠ¤æ–¹å¼å®ç°

æ±‚ä¸€ä¸ª Group ä¸­æ‰€æœ‰è¾¹çš„è¾¹æƒä¹‹å’Œã€‚å¯¹äºè¯¥æ–¹æ³•å¦‚æœç›´æ¥æŒ‰ç…§è§„æ ¼å»å¯¹ç»„å†…çš„ Person è¿›è¡ŒäºŒé‡å¾ªç¯éå†å¹¶ä¸¤ä¸¤åˆ¤æ–­æ˜¯å¦æœ‰è¾¹ï¼Œåˆ™å•æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ï¼Œå¦‚æœå¼ºæµ‹æ•°æ®ä¸­æœ‰å¤§é‡çš„ qgvs æŒ‡ä»¤ä¾¿å¯èƒ½ä¼šè¶…æ—¶ ã€‚æˆ‘çš„æ–¹å¼æ˜¯é‡‡å–ç»´æŠ¤çš„æ–¹å¼å®ç°ï¼Œå®ç°æ–¹æ³•æ˜¯é‡‡ç”¨ä¸€ä¸ªå˜é‡æ¥è®°å½•å½“å‰ Group ä¸­æ‰€æœ‰è¾¹çš„è¾¹æƒä¹‹å’Œï¼Œåœ¨å¯¹è¯¥ç»„ `addPerson` ä¸ `delPerson` ï¼Œä»¥åŠå¯¹ç»„å†…çš„äººè¿›è¡Œ `addRelation` æ—¶å¯¹è¾¹æƒå’Œè¿›è¡Œç»´æŠ¤ï¼Œå¯¹valueå€¼è¿›è¡Œæ›´æ–°ï¼Œä½¿å¾— `getValueSum` æ–¹æ³•æœ¬èº«çš„å¤æ‚åº¦ä¸º O(1) ï¼Œå¯ä»¥æ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚

#### 1.2.2 getAgeMeanä¸getAgeVar ----ç»´æŠ¤æ–¹å¼å®ç°

æ±‚ä¸€ä¸ªç”¨æˆ·ç»„å†…æ‰€æœ‰ç”¨æˆ·çš„å¹´é¾„å¹³å‡å€¼ä¸å¹´é¾„æ–¹å·®ï¼Œå¦‚æœæŒ‰ç…§JMLæ–¹å¼æ¥å®ç°ï¼Œæ˜¯ä¸€ä¸ªO(n)çš„ä¸€é‡å¾ªç¯ï¼Œè™½ç„¶æ•°æ®å°‘æ—¶ä¸ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯å¤šæ¬¡æŸ¥è¯¢æ—¶ï¼Œæ¯æ¬¡éƒ½è¦é‡æ–°è®¡ç®—ï¼Œéš¾å…ä¼šé™ä½æ€§èƒ½ã€‚å› æ­¤åŒæ ·é‡‡ç”¨ç»´æŠ¤çš„æ–¹å¼å®ç°ï¼Œåœ¨æ­¤æˆ‘ä»¬å¼•å…¥å¹´é¾„å¹³æ–¹å’Œ*ageSqrSum*ï¼Œ*ageSum*åœ¨`addPerson`å’Œ`delPerson`æ—¶å¯¹*ageAqrSum*ï¼Œ*ageSum*è¿›è¡Œæ›´æ–°ï¼ˆç›¸åº”çš„åŠ å‡æ“ä½œï¼‰ï¼ŒgetAgeMeanä¸getAgeVarå¯ä»¥ç”¨å…¬å¼

![](https://note.youdao.com/yws/api/personal/file/B47023C3E9EB4605BF16E42A3FB89425?method=download&shareKey=2e2d32060012aca862c8a88e8434eb38)



æ±‚å‡ºï¼Œæ³¨æ„å…¬å¼çš„è®¡ç®—ä¸€å®šè¦æŒ‰ç…§JMLå±•å¼€ä¸”ä¸èƒ½éšæ„åŒ–ç®€ï¼Œå¦åˆ™ä¼šå‡ºç°ç²¾åº¦é—®é¢˜ã€‚

#### 1.2.3 isCircle ---- å¹¶æŸ¥é›†å®ç°

 è¯¥æ–¹æ³•å®é™…æ„ä¹‰ä¸ºåˆ¤æ–­æ— å‘å›¾ä¸Šçš„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿é€šï¼Œå¯é‡‡ç”¨å¹¶æŸ¥é›†æ¥å®ç°ã€‚å¹¶æŸ¥é›† ç›¸å…³èµ„æ–™åœ¨ç½‘ä¸Šå¾ˆå¤šï¼Œé˜…è¯»ä¹‹åå¾ˆå¿«å°±å¯ä»¥ç†è§£ï¼Œå…¶ç²¾ååœ¨äº**è®°å½•æ¯ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„ç»„å·ï¼ˆè¿™é‡Œçš„ç»„ä¸æ˜¯æˆ‘ä»¬å®ç°çš„Groupçš„æ„æ€ï¼Œè€Œæ˜¯è¿™ä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„å­å›¾ï¼‰ï¼Œè¾¹æŸ¥æ‰¾è¾¹æ›´æ–°**ã€‚ç”¨å¹¶æŸ¥é›†çš„æ–¹æ³•ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è¿é€šåªè¦æŸ¥æ‰¾å…¶ç»„å·æ˜¯å¦ç›¸åŒã€‚

#### 1.2.4 queryBlockSum ---- ç»´æŠ¤å®ç°

è¯¥æ–¹æ³•æ±‚æ— å‘å›¾ä¸­è¿é€šå—çš„æ•°é‡ï¼Œå¼•å…¥å˜é‡blockSumåˆå§‹åŒ–ä¸º0ã€‚addPesonæ—¶ï¼Œè¯¥Personä¸ä»»ä½•äººéƒ½æ— å…³ç³»ï¼ŒblockSumè‚¯å®šåŠ 1ï¼Œåœ¨addRelationæ—¶ï¼Œå¦‚æœè”é€šçš„ä¸¤äººä¸å±äºåŒä¸€ä¸ªå­å›¾ï¼Œè”é€šäºŒè€…ä»¥åblockSumå‡1ã€‚

#### 1.2.5 sendIndirectMessage ----  å †ä¼˜åŒ–çš„Dijkstra ç®—æ³•

è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸¤ä¸ªäººä¹‹é—´çš„æœ€çŸ­è·¯ï¼Œéœ€é‡‡ç”¨ Dijkstra ç®—æ³•å¯¹æ— å‘å›¾ä¸­çš„å•æºæœ€çŸ­è·¯è¿›è¡Œæ±‚è§£ã€‚æ³¨æ„ä½¿ç”¨ Dijkstra æ—¶éœ€è¦é‡‡ç”¨å †ä¼˜åŒ–ã€‚

#### 1.2.6 queryLeastConnection ---- å¹¶æŸ¥é›†+kruskalç®—æ³•å®ç°æœ€å°ç”Ÿæˆæ ‘

è¿™ä¸ªå‡½æ•°è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°æŸä¸€èŠ‚ç‚¹æ‰€åœ¨çš„å­å›¾çš„æœ€å°ç”Ÿæˆæ ‘ã€‚é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨ä¹‹å‰å®ç°çš„å¹¶æŸ¥é›†å¯ä»¥æ‰¾åˆ°è¯¥èŠ‚ç‚¹æ‰€åœ¨çš„å­å›¾ï¼Œæ¥ä¸‹æ¥ä½¿ä¹‹å‰å­¦è¿‡çš„çš„Kruskalç®—æ³•å®ç°æœ€å°ç”Ÿæˆæ ‘å³å¯ï¼ˆå½“ç„¶ä½¿ç”¨å…¶ä»–çš„æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ä¾‹å¦‚Primä¹Ÿå¯ä»¥ï¼‰ã€‚

## 2.1 Hackç­–ç•¥ä¸æµ‹è¯•æ–¹æ³•

### 2.1.2 æµ‹è¯•æ–¹æ³•

æœ¬å•å…ƒä¸­å†è¿›è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä¸€å¼€å§‹å°è¯•å­¦ä¹ äº†Junitæ–¹æ³•ï¼Œä½†æ˜¯æ„Ÿè§‰ä½œç”¨ä¸å¤§ï¼Œä¸å¦‚å’Œä¼™ä¼´ä»¬ä¸€èµ·å¯¹æ‹æ¥çš„å¿«ä¸”é«˜æ•ˆã€‚ä¸‹é¢æ˜¯ç¼–å†™çš„ä¸€ä¸ªç®€å•çš„æ•°æ®è‡ªåŠ¨ç”Ÿæˆç¨‹åºï¼Œæ€»ä½“ä¸Šé‡‡ç”¨éšæœºç”Ÿæˆçš„ç­–ç•¥ï¼Œå…ˆåŠ å…¥å¿…è¦çš„å…ƒç´ ï¼Œå†åŠ å…¥å¤§é‡çš„queryæŸ¥è¯¢æ–¹æ³•ã€‚ç”¨è¿™ç§æ–¹æ³•æˆ‘å’Œä¼™ä¼´ä»¬ä¹Ÿç¡®å®æœ‰æ•ˆå¿«é€Ÿåœ°æ‰¾åˆ°äº†ä¸€äº›Bugï¼Œå› æ­¤æœ¬å•å…ƒå¼ºæµ‹äº’æµ‹éƒ½æ²¡æœ‰å‡ºç°Bugã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªå•å…ƒä¸å‰ä¸¤ä¸ªå•å…ƒç›¸æ¯”ï¼Œç”Ÿæˆæ•°æ®çš„æ–¹æ³•æ›´åŠ ç®€å•ï¼ŒåŒæ—¶è¾“å‡ºçš„ç»“æœä¹Ÿæ˜¯ä¸€å®šçš„ï¼Œé‡‡ç”¨å¯¹æ‹çš„æ–¹å¼å¯¹äºç¬¬ä¸‰å•å…ƒæ¥è¯´éå¸¸æœ‰æ•ˆã€‚

```python
#æ•°æ®è‡ªåŠ¨ç”Ÿæˆå™¨
import os
import random

# 1000äºº id 0 ---- 4000
numof_person = 1000
# 25ç»„   id 0 ---- 10
numof_group = 10
# 3000æ¡å…³ç³»
numof_relation = 3000
# 500 for 3 kinds of message
numof_red_envelop_message = 250  # 250 type0,250type1 total 500
numof_notice_message = 250  # 250 type0,250type1 total 500
numof_emoji_message = 250  # 250 type0,250type1 total 500
numof_message = 250  # 250 type0,250type1 total 500

# å®ç°messeageidç‹¬ä¸€æ— äºŒ

def spawn():
    total = 0
    f = open("testPoints.txt", "w")
    cnt = []
    for i in range(0, 18):
        cnt.append(0)
    i = 0

    # ag 10
    for j in range(numof_group):
        f.write("ag " + str(j) + "\n")
    # ap 1000 times and add to random group
    for j in range(numof_person):
        f.write("ap " + str(j) +
                " testname" + " " +
                str(random.randint(0, 200)) + " \n")
        f.write("atg " + str(j) + " " +
                str(random.randint(0, numof_group)) + "\n")

    # ar 3000
    for j in range(numof_relation):
        f.write("ar " + str(random.randint(0, numof_person)) + " " +
                str(random.randint(0, numof_person)) + " " +
                str(random.randint(0, 1000)) + "\n")
    # am 250type1 250 type0
    for j in range(numof_message):
        m0 = "am " + str(j) + " " + \
             str(random.randint(-1000, 1000)) + " " + \
             str(0) + " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_person)) + "\n"
        m1 = "am " + str(numof_message + j) + " " + \
             str(random.randint(-1000, 1000)) + " " + \
             str(1) + " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_group)) + "\n"
        f.write(m0)
        f.write(m1)

    total += 2 * numof_message

    # arem add red envelop
    for j in range(numof_red_envelop_message):
        m0 = "arem " + str(total + j) + " " + \
             str(random.randint(0, 200)) + " " + str(0) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_person)) + "\n"
        m1 = "arem " + str(total + numof_red_envelop_message + j) + " " + \
             str(random.randint(0, 200)) + " " + str(1) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_group)) + "\n"
        f.write(m0)
        f.write(m1)
    total += 2 * numof_red_envelop_message

    # add notice
    for j in range(numof_notice_message):
        m0 = "anm " + str(total + j) + " " + \
             "goodluck" + " " + str(0) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_person)) + "\n"
        m1 = "anm " + str(total + numof_notice_message + j) + " " + \
             "goodluck" + " " + str(1) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_group)) + "\n"
        f.write(m0)
        f.write(m1)
    total += 2 * numof_notice_message

    # store some emoji
    for j in range(200):
        f.write("sei " + str(j) + "\n")
        f.write("sei " + str(numof_emoji_message + j) + "\n")

    # add emoji
    for j in range(numof_emoji_message):
        m0 = "aem " + str(total + j) + " " + \
             str(j) + " " + str(0) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_person)) + "\n"
        m1 = "aem " + str(total + numof_emoji_message + j) + " " + \
             str(numof_emoji_message + j) + " " + str(1) + \
             " " + str(random.randint(0, numof_person)) + " " + \
             str(random.randint(0, numof_group)) + "\n"
        f.write(m0)
        f.write(m1)
    total += 2 * numof_emoji_message

    ##########################################
    # now we start query!!!!!!!!!!!!
    ##########################################
    while i < 10000:
        number = random.randint(0, 15)

        if number == 0:
            f.write("qci " + str(random.randint(0, numof_person)) + " " +
                    str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 1:
            f.write("qbs\n")
            i += 1
        elif number == 2:
            f.write("qgps " + str(random.randint(0, numof_group)) + "\n")
            i += 1
        elif number == 3:
            f.write("qgvs " + str(random.randint(0, numof_group)) + "\n")
            i += 1
        elif number == 4:
            f.write("qgav " + str(random.randint(0, numof_group)) + "\n")
            i += 1
        elif number == 5:
            f.write("sm " + str(random.randint(0, total)) + "\n")
            i += 1
        elif number == 6:
            f.write("qsv " + str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 7:
            f.write("qrm " + str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 8:
            f.write("qlc " + str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 9:
            f.write(
                "dfg " + str(random.randint(0, numof_person)) + " " + str(random.randint(0, numof_group)) + "\n")
            i += 1
        elif number == 10:
            f.write("cn " + str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 11:
            f.write("sei " + str(random.randint(0, 2 * numof_emoji_message)) + "\n")
            i += 1
        elif number == 12:  # qp
            f.write("qp " + str(random.randint(0, 2 * numof_emoji_message)) + "\n")
            i += 1
        elif number == 13:  # qm
            f.write("qm " + str(random.randint(0, numof_person)) + "\n")
            i += 1
        elif number == 14:  #
            f.write("sim " + str(random.randint(0, total)) + "\n")
        if random.randint(0, 10000) < 10:  # dce ä¸èƒ½åŠ å¤ªå¤š
            f.write("dce " + str(random.randint(0, 10)) + "\n")
    f.close()


if __name__ == "__main__":
    spawn()

```

### 2.1.3 Hackç­–ç•¥

åœ¨æœ¬å•å…ƒHackæ—¶ï¼Œå¤§å®¶å‡ºé—®é¢˜çš„åœ°æ–¹å¾€å¾€æ˜¯æ²¡æœ‰è®¤çœŸä»”ç»†é˜…è¯»JMLï¼Œæ¯”å¦‚ç»„å†…äººæ•°ä¸èƒ½è¶…è¿‡1111ç­‰ç­‰ã€‚å¦ä¸€ä¸ªå°±æ˜¯æ€§èƒ½é—®é¢˜ï¼Œæˆ‘åœ¨Hackæ—¶é‡‡ç”¨çš„æ˜¯é˜…è¯»ä»£ç ï¼Œé’ˆå¯¹å®¹æ˜“å‡ºé—®é¢˜çš„åœ°æ–¹æ¯”å¦‚è¯´1111è¿™ç±»çš„é—®é¢˜ï¼Œç›´æ¥åœ¨ä»£ç é‡Œçœ‹æœ‰æ²¡æœ‰å‡ºé—®é¢˜ã€‚å†ä¸€ä¸ªå°±æ˜¯é’ˆå¯¹æ¯æ¬¡ä½œä¸šä¸­å®¹æ˜“å‡ºé—®é¢˜çš„æ€§èƒ½é—®é¢˜çš„æ–¹æ³•æ¯”å¦‚qgvs,qgbs,qicç­‰ç­‰æ–¹æ³•ï¼Œæ„é€ å¤§é‡çš„æŸ¥è¯¢queryæ•°æ®æ¥çœ‹å…¶æ˜¯å¦è¶…æ—¶ã€‚è¿™ä¸¤ä¸ªç­–ç•¥éƒ½æ¯”è¾ƒç®€å•è€Œä¸”æœ‰æ•ˆã€‚

## 3.1 Networkå›¾æ¨¡å‹æ¶æ„çš„æ‰©å±•

### 3.1.1 éœ€æ±‚åˆ†æ

å‡è®¾å‡ºç°äº†å‡ ç§ä¸åŒçš„Person

- `Advertiser`ï¼šæŒç»­å‘å¤–å‘é€äº§å“å¹¿å‘Š
- `Producer`ï¼šäº§å“ç”Ÿäº§å•†ï¼Œé€šè¿‡Advertiseræ¥é”€å”®äº§å“
- `Customer`ï¼šæ¶ˆè´¹è€…ï¼Œä¼šå…³æ³¨å¹¿å‘Šå¹¶é€‰æ‹©å’Œè‡ªå·±åå¥½åŒ¹é…çš„äº§å“æ¥è´­ä¹° -- æ‰€è°“è´­ä¹°ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡`Advertiser`ç»™ç›¸åº”`Producer`å‘ä¸€ä¸ªè´­ä¹°æ¶ˆæ¯
- `Person`ï¼šåƒç“œç¾¤ä¼—ï¼Œä¸å‘å¹¿å‘Šï¼Œä¸ä¹°ä¸œè¥¿ï¼Œä¸å–ä¸œè¥¿

1. NetWorkå¯ä»¥æ”¯æŒå¸‚åœºè¥é”€ï¼Œå¹¶èƒ½æŸ¥è¯¢æŸç§å•†å“çš„é”€å”®é¢å’Œé”€å”®è·¯å¾„
2. è¯·è®¨è®ºå¦‚ä½•å¯¹Networkæ‰©å±•ï¼Œç»™å‡ºç›¸å…³æ¥å£æ–¹æ³•ï¼Œå¹¶é€‰æ‹©3ä¸ªæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½çš„æ¥å£æ–¹æ³•æ’°å†™JMLè§„æ ¼

### 3.1.2 è®¾æƒ³æ¶æ„

1. `Advertiser`, `Producer`, `Customer`æœ¬è´¨ä¸Šéƒ½æ˜¯Personï¼Œå¯ä»¥è®©ä»–ä»¬å‡ç»§æ‰¿Personç±»
2. å¹¿å‘Šæœ¬è´¨ä¸Šæ˜¯ä¸€æ¡Messageï¼Œæ–°å¢å¹¿å‘Šç±»Advertisementç»§æ‰¿ Message
3. æ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦å•†å“ç±»Productï¼Œæ–°å¢å•†å“ç±»Product

**ä¸€ä¸‹æ˜¯ä¸Šè¿°ç±»å†…éƒ¨çš„å¤§è‡´å±æ€§ä¸æ–¹æ³•(ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•ç±»ä¼¼getterï¼Œsetteræ²¡æœ‰åˆ—å‡º)**

```java
//Product
private int id; //å•†å“idç‹¬ä¸€æ— äºŒ
private int price; //å•†å“ä»·æ ¼
private int type ï¼›//å•†å“çš„ç§ç±»ï¼Œè¿™é‡Œç”¨intæ¥ä»£è¡¨
    
    
//Advertisement
private int id ;//ç‹¬ä¸€æ— äºŒçš„id
private Product product;//è¯¥å¹¿å‘Šæ‰€å¯¹åº”çš„å•†å“
private Person advertiser;//è¯¥å¹¿å‘Šçš„æºå¤´å¹¿å‘Šå•†
private Group group; //ä¸€èˆ¬å¹¿å‘Šä¸æ­¢å‘ç»™æŸä¸€ä¸ªäººï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é»˜è®¤ç›´æ¥å‘å¾€æŸä¸€ç»„çš„æ‰€æœ‰äºº


//Adevertiser
private ArrayList<Advertisement> ads; //å¾…å‘é€çš„å¹¿å‘Š
public void sendAd(Advertisement ad);//å‘ä¸€æ¡å¹¿å‘Šï¼Œè¦æƒ³å®ç°â€œAdvertiseræŒç»­å‘å¤–å‘é€äº§å“å¹¿å‘Šâ€å¯ä»¥å°†Adevertiserå®ç°ä¸ºè¿›ç¨‹ç„¶åä¸æ–­æ“ä½œè¯¥æ–¹æ³•
public void addAd(Product productï¼ŒPerson personï¼ŒGroup group);//adsåŠ å…¥ä¸€æ¡å…³äºproductçš„å¹¿å‘Š
public void sendBuymessage(Advertisement ad);//ç»™Producerå‘é€ä¸€æ¡è´­ä¹°æ¶ˆæ¯


//Producer
private Advertiser advertiser;//å¯¹æ¥çš„å¹¿å‘Šå•†ï¼Œå‘é€å¹¿å‘Šæ—¶é€šè¿‡ä»–
private ArrayList<Product> products;//å·²ç”Ÿäº§çš„å•†å“
private HashMap<Integer,Integer> sales;//typeç±»å‹å•†å“å¯¹åº”é”€å”®é¢

public void sell(Product product,Group group)//å”®å–productï¼Œé€šè¿‡å¹¿å‘Šå•†å‘ä¸€æ¡å¹¿å‘Šç»™groupé‡Œçš„æ‰€æœ‰äºº
public void produce(Product product);//ç”Ÿäº§ä¸€ä¸ªproduct
public int querySales(int type) ;//æŸ¥è¯¢æŸä¸€äº§å“é”€å”®é¢
public int getSalesAmount();//å¾—åˆ°HashMapå¯¹åº”typeç§ç±»å•†å“çš„é”€å”®é¢

//Customer
private int id;
private HashMap<Integer,Integer> like; //typeçš„å•†å“å¯¹åº”çš„å–œçˆ±å€¼ type - likevalue
private ArrayList<Advertisement> recieveAds;//ç›®å‰ä¸ºæ­¢æ¥å—åˆ°çš„å¹¿å‘Š
public void buy();//ä»ç›®å‰çš„æ”¶åˆ°çš„å¹¿å‘Šé‡ŒæŒ‘ä¸€ä¸ªæœ€çˆ±çš„typeç±»å‹çš„å•†å“è´­ä¹°ï¼Œå¦‚æœæœ‰å¤šä¸ªæœ€å–œçˆ±çš„å•†å“çš„å¹¿å‘Šï¼Œåªå–æœ€æ—©æ¥æ”¶åˆ°çš„é‚£ä¸ªï¼Œä¸€æ¬¡åªä¹°ä¸€ä¸ª
public void addReceiveAds(Advertisement);//æ”¶åˆ°ä¸€æ¡å¹¿å‘Š
```

### 3.1.3 æ ¸å¿ƒç±»JMLæ’°å†™

ä¸‹é¢æŒ‘é€‰äº†ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•çš„JMLç±»è¿›è¡Œæ’°å†™ï¼š

```java
//Producer

/*@ public normal_behavior
  @ requires !(\exists int i; 0 <= i && i < products.length;                               @       products[i].equals(product));
  @ assignable products;
  @ ensures products.length == \old(products.length) + 1;
  @ ensures (\forall int i; 0 <= i && i < \old(products.length);
  @          (\exists int j; 0 <= j && j < products.length; products[j] == (\old(products[i]))));
  @ ensures (\exists int i; 0 <= i && i < products.length; products[i] == product);
  @ also
  @ public exceptional_behavior
  @ signals (EqualProductIdException e) (\exists int i; 0 <= i && i < products.length;
  @                                     products[i].equals(product));
  @*/
public void produce(Product product) throws EqualProductIdException;


//Advertiser
    /*@ public normal_behavior
      @ requires containsAd(ad)
      @ assignable ad.group.people[*].recieveAds,ads;
      @ ensures !containsAd(id) && ads.length == \old(ads.length) - 1 &&
      @         (\forall int i; 0 <= i && i < \old(ads.length) && \old(ads[i].getId()) != id;
      @         (\exists int j; 0 <= j && j < ads.length; ads[j].equals(\old(ads[i]))));
      @ ensures (\forall Person p; ad.getGroup().hasPerson(p) && (p instance of Customer);                  
      @			p.receiveAds.length == \old(p.receiveAds.length) + 1;
      @         && (\forall int i; 0 <= i && i < \old(p.receiveAds.length);
      @             (\exists int j; 0 <= j && j < p.receiveAds.length;                         @                     p.receiveAds[j].equals(\old(p.receiveAds[i]))));
      @         && (\exists int i; 0 <= i && i < p.receiveAds.length; p.receiveAds[i].equals(ad));
      @ also
      @ public exceptional_behavior
      @ signals (AdNotFoundException e) !containsAd(ad);
      @*/
public void sendAd(Advertisement ad);

//Producer
	/*@ public normal_behavior
      @ requires containsType(type);
      @ ensures \result == getSalesAmount();
      @ also
      @ public exceptional_behavior
      @ signals (TypeNotFoundException e) !containsType(type);
      @*/
public int querySales(int type) ;



```

##  å¿ƒå¾—ä½“ä¼š

æœ¬å•å…ƒéš¾åº¦ä¸å¤§ï¼Œä¸»è¦æ˜¯åœ¨å­¦ä¹ ä¸€äº›JMLçš„åŠŸèƒ½ï¼ŒåŒæ—¶åœ¨è¿™ä¸€å•å…ƒä¹Ÿå­¦ä¹ åˆ°äº†ä¸€äº›ç®—æ³•çš„å†…å®¹ç±»ä¼¼å¹¶æŸ¥é›†ï¼Œå †ä¼˜åŒ–çš„è¿ªæ°æ–¯ç‰¹æ‹‰ç®—æ³•ç­‰ç­‰ã€‚

åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªå°å»ºè®®ï¼Œå¦‚æœè¿™ä¸ªå•å…ƒä¸»è¦å†…å®¹æ˜¯è®©å¤§å®¶å­¦ä¼šJMLçš„é˜…è¯»å’Œç†è§£çš„è¯ï¼Œæˆ‘è§‰å¾—å¯èƒ½ä¸éœ€è¦ä¸‰æ¬¡ä½œä¸šï¼Œ1~2æ¬¡ä½œä¸šæˆ‘è§‰å¾—å·²ç»è¶³å¤Ÿ,ç¬¬ä¸‰æ¬¡ä½œä¸šçš„è¯æ„Ÿè§‰å°±æ˜¯åœ¨å­¦ä¹ å†™æ›´å¤šçš„ç®—æ³•ï¼Œå…¶ä¸­JMLçš„ä¸œè¥¿è¿˜æ˜¯ç¬¬1,2æ¬¡ä½œä¸šé‚£äº›ä¸œè¥¿ï¼Œæ²¡æœ‰å­¦åˆ°ä»€ä¹ˆæ–°çš„JMLçš„çŸ¥è¯†ï¼Œæ„Ÿè§‰æ²¡æœ‰å¿…è¦ã€‚
